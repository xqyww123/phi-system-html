<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹library/tools/unfold_typeof.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹library/tools/unfold_typeof.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>SEMANTIC_TYPE_TOOLS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unfold_typeof </span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>option</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unfold_typeof_simproc </span><span class="main"><span>:</span></span><span> </span><span>simproc</span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Semantic_Type_Tools</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SEMANTIC_TYPE_TOOLS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>lemma</span></span><span>
  </span><span class="quoted"><span>‹ </span><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.Semantic_Type|const"><span>Semantic_Type</span></a><span> </span><span class="free"><span>T</span></span><span> </span><span class="free"><span>TY</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Branch|const"><span>|||</span></a></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR_error_msg.html#PLPR_error_msg.EXCEPTION|const"><span>EXCEPTION</span></a><span> </span><span class="keyword1"><span>TEXT(</span></span><span class="inner_cartouche"><span>‹S›</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_BI.html#Phi_BI.Inhabited|const"><span>Inhabited</span></a><span> </span><span class="free"><span>T</span></span><span>        </span><span class="main"><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Branch|const"><span>|||</span></a></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR_error_msg.html#PLPR_error_msg.EXCEPTION|const"><span>EXCEPTION</span></a><span> </span><span class="keyword1"><span>TEXT(</span></span><span class="inner_cartouche"><span>‹I›</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.\&lt;r&gt;Success|const"><span>𝗋Success</span></a><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Proof_Obligation|const"><span>𝗈𝖻𝗅𝗂𝗀𝖺𝗍𝗂𝗈𝗇</span></a></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>
</span><span class="main"><span>⟹</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.Type_Of_syntax|const"><span>𝗍𝗒𝗉𝖾𝗈𝖿</span></a></span><span> </span><span class="free"><span>T</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span>TY</span></span><span> ›</span></span><span>
  </span><span class="quasi_keyword"><span>by</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span>:</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.atomize_Branch|fact"><span>atomize_Branch</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR_error_msg.html#PLPR_error_msg.EXCEPTION_def|fact"><span>EXCEPTION_def</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.SType_Of_unfold|fact"><span>SType_Of_unfold</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
</span><span class="antiquote"><span>}</span></span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unfold_typeof</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cterm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>cterm</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"T"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>T_term</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>rule0</span></span><span>
   </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Reasoner.reason</span></span><span> </span><span>NONE</span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span>Config.map</span><span> </span><span class="entity"><span>Phi_Reasoner.trace</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>i</span></span><span>-</span><span class="inner_numeral"><span>3</span></span><span class="main"><span>)</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
   </span><span>|&gt;</span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Conv.implies_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop_conv</span></span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Premise_def|fact"><span>Premise_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                           </span><span>Conv.all_conv</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>PLPR_EXCEPTION</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="entity"><span>Phi_Reasoner.warn_pretty</span></span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Pretty</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>block</span><span> </span><span class="main"><span>(</span></span><span>text</span><span> </span><span class="inner_quoted"><span>"Fail to unfold"</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>cterm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
               </span><span>text</span><span> </span><span class="inner_quoted"><span>"because fail to infer the semantic type of φ-type"</span></span><span> </span><span>@</span><span>
               </span><span class="main"><span>[</span></span><span>brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>T_term</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>str</span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>,</span></span><span> </span><span>brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
               </span><span>text</span><span> </span><span class="inner_quoted"><span>"I need property ("</span></span><span> </span><span>@</span><span>
               </span><span class="main"><span>[</span></span><span>brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.Semantic_Type|const"><span>Semantic_Type</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span>dummyT</span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>T_term</span></span><span> </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="free"><span>TY</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.TY|type"><span>TY</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>str</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>)</span></span><span>
       </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>PLPR_EXCEPTION</span></span><span> </span><span class="inner_quoted"><span>"I"</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="entity"><span>Phi_Reasoner.warn_pretty</span></span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Pretty</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>block</span><span> </span><span class="main"><span>(</span></span><span>text</span><span> </span><span class="inner_quoted"><span>"Fail to unfold"</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>cterm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
               </span><span>text</span><span> </span><span class="inner_quoted"><span>"because fail to infer the Inhabitance of φ-type"</span></span><span> </span><span>@</span><span>
               </span><span class="main"><span>[</span></span><span>brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>T_term</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
               </span><span>text</span><span> </span><span class="inner_quoted"><span>"I need property ("</span></span><span> </span><span>@</span><span>
               </span><span class="main"><span>[</span></span><span>brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_BI.html#Phi_BI.Inhabited|const"><span>Inhabited</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span>dummyT</span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>T_term</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>str</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfold_typeof_simproc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Simplifier.make_simproc</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span> </span><span class="inner_quoted"><span>"φ.𝗍𝗒𝗉𝖾𝗈𝖿"</span></span><span> </span><span class="main"><span>{</span></span><span>
        lhss </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">pattern</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.Type_Of_syntax|const"><span>𝗍𝗒𝗉𝖾𝗈𝖿</span></a></span><span> </span><span class="var"><span>?T</span></span><span>›</span></span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        proc </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_typeof</span></span><span>
    </span><span class="main"><span>}</span></span><span>

</span><span class="comment1"><span>(*
val infer_generalized_semantic_type = @{lemma ‹
    Generalized_Semantic_Type T TY
  ›}

fun generalized_semantic_type_of T ctxt =
  let 
   in ()
  end
*)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Syntactical_Type_Of</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Pattern_Translation</span></span><span> </span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>check_pattern</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Syntax.check_terms</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_pattern</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Syntax.parse_term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>multi_translation_err_msg</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="inner_quoted"><span>"The φ-type is registered with multiple inconsistent semantic types!"</span></span><span>
</span><span class="main"><span>)</span></span><span>
</span></pre>
</body>

</html>